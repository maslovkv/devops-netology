# Домашнее задание к занятию 6. «Troubleshooting»## Задача 1Перед выполнением задания ознакомьтесь с документацией по [администрированию MongoDB](https://docs.mongodb.com/manual/administration/).Пользователь (разработчик) написал в канал поддержки, что у него уже 3 минуты происходит CRUD-операция в MongoDB и её нужно прервать. Вы как инженер поддержки решили произвести эту операцию:- напишите список операций, которые вы будете производить для остановки запроса пользователя;Используем [mogodb-shell](https://www.mongodb.com/docs/mongodb-shell/) и [методы](https://www.mongodb.com/docs/manual/reference/method/js-database/). 1. Найдем операцию выполняющуюся дольше 3 мин.[Документация.](https://www.mongodb.com/docs/manual/reference/method/db.currentOp/#std-label-currentOp-method-examples)```commandlinedb.currentOp(   {     "active" : true,     "secs_running" : { "$gt" : 180 },     "effectiveUsers" : {"user" : knownuser}   })```2. Прервем операцию используя `opid` из вывода предыдущего запроса. `db.killOp(opid)`- предложите вариант решения проблемы с долгими (зависающими) запросами в MongoDB.<details><summary></summary>[Рекомендации вендора](https://www.mongodb.com/docs/manual/tutorial/optimize-query-performance-with-indexes-and-projections/)</details>1. Создать индексы для поддержки запросов.   <details>   <summary>Важно</summary>   Каждый новый индекс замедляет запись. Большое количество индексов может негативно влиять на производительность при записи.</p>   </details>      2. Ограничить количество результатов запросов.3. Использование частичного извлечения (projection).4. Использование `$hint` для использования конкретного индекса.5. Использовать оператор обновления поля [`$inc`](https://www.mongodb.com/docs/manual/reference/operator/update/inc/#mongodb-update-up.-inc)6. [Проанализоровать](https://www.mongodb.com/docs/manual/tutorial/analyze-query-plan/) запрос.   Возможно нужно исправлять логические ошибки приложения.7. Разбить таблицу.<details><summary>PS</summary>Думаю, что это только часть того, что можно предпринять. </details>## Задача 2Перед выполнением задания познакомьтесь с документацией по [Redis latency troobleshooting](https://redis.io/topics/latency).Вы запустили инстанс Redis для использования совместно с сервисом, который использует механизм TTL. Причём отношение количества записанных key-value-значений к количеству истёкших значений есть величина постоянная иувеличивается пропорционально количеству реплик сервиса. При масштабировании сервиса до N реплик вы увидели, что:- сначала происходит рост отношения записанных значений к истекшим,- Redis блокирует операции записи.Как вы думаете, в чём может быть проблема?Проблема, скорее всего в нехватке памяти или (и) очень большом количестве одновременно истекающих ключей.Reddis начинает вытеснять истекающие ключи, когда отношение истекающих ключейко всем достигает 25%. Что приводит в блокировке.<details><summary>Подробности</summary>[В документации](https://redis.io/docs/management/optimization/latency/)</details> ## Задача 3Вы подняли базу данных MySQL для использования в гис-системе. При росте количества записей в таблицах базыпользователи начали жаловаться на ошибки вида:```pythonInterfaceError: (InterfaceError) 2013: Lost connection to MySQL server during query u'SELECT..... '```Как вы думаете, почему это начало происходить и как локализовать проблему?Запрос слишком большой.Клиент не успевает его получить за отведенное время таймаута.<details><summary>Подробности</summary>[В документации](https://dev.mysql.com/doc/refman/8.0/en/error-lost-connection.html)</details>Вендор предлагает увеличить значение [`net_read_timeout`](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_net_read_timeout)до 60 секунд или более.<details><summary>Подробности</summary>[В документации](https://dev.mysql.com/doc/refman/8.0/en/error-lost-connection.html)</details>Какие пути решения этой проблемы вы можете предложить?Если решения от вендора недостаточно:1. Оптимзация запроса.1. Разбиение таблицы.1. Создание индексов.1. Кластеризация и масштабирование MySQL.1. Смена движка БД или смена СУБД.<details><summary>PS</summary>Думаю, что это ещё не все [варианты](https://dev.mysql.com/doc/refman/8.0/en/optimization.html).</details>## Задача 4Вы решили перевести гис-систему из задачи 3 на PostgreSQL, так как прочитали в документации, что эта СУБД работает с большим объёмом данных лучше, чем MySQL.После запуска пользователи начали жаловаться, что СУБД время от времени становится недоступной. В dmesg вы видите, что:`postmaster invoked oom-killer`Как вы думаете, что происходит?В системе наблюдается нехватка памяти.Out-Of-Memory Killer завершает процесс как самый "плохой".Как бы вы решили эту проблему?Может помочь уменьшение конфигурационных параметров, связанных с памятью,а именно [shared_buffers](https://postgrespro.ru/docs/postgresql/15/runtime-config-resource#GUC-SHARED-BUFFERS), [work_mem](https://postgrespro.ru/docs/postgresql/15/runtime-config-resource#GUC-WORK-MEM)и [hash_mem_multiplier](https://postgrespro.ru/docs/postgresql/15/runtime-config-resource#GUC-HASH-MEM-MULTIPLIER).В других случаях проблема может возникать, потому что разрешено слишком много подключений к самому серверу баз данных.Чаще всего в такой ситуации стоит уменьшить число подключений [max_connections](https://postgrespro.ru/docs/postgresql/15/runtime-config-connection#GUC-MAX-CONNECTIONS)и организовать внешний пул соединений.---### Как cдавать заданиеВыполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.---